<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 520" font-family="'Source Sans Pro', Arial, sans-serif">
  <defs>
    <marker id="arrow" viewBox="0 0 10 6" refX="10" refY="3" markerWidth="10" markerHeight="6" orient="auto">
      <path d="M0,0 L10,3 L0,6 Z" fill="#5d4037"/>
    </marker>
    <linearGradient id="greenGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#388e3c"/>
      <stop offset="100%" stop-color="#2e7d32"/>
    </linearGradient>
    <linearGradient id="brownGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#795548"/>
      <stop offset="100%" stop-color="#5d4037"/>
    </linearGradient>
    <linearGradient id="tealGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#00897b"/>
      <stop offset="100%" stop-color="#00695c"/>
    </linearGradient>
    <filter id="shadow" x="-4%" y="-4%" width="108%" height="112%">
      <feDropShadow dx="1" dy="2" stdDeviation="2" flood-opacity="0.15"/>
    </filter>
  </defs>

  <!-- Title -->
  <text x="450" y="35" text-anchor="middle" font-size="20" font-weight="bold" fill="#1b5e20">GRootR Processing Pipeline</text>

  <!-- Row 1: Load -->
  <rect x="30" y="60" width="170" height="55" rx="10" fill="url(#greenGrad)" filter="url(#shadow)"/>
  <text x="115" y="83" text-anchor="middle" font-size="11" fill="#fff" font-weight="600">ğŸ“„ CSV File</text>
  <text x="115" y="101" text-anchor="middle" font-size="9" fill="#c8e6c9">load_root_csv()</text>

  <line x1="200" y1="87" x2="240" y2="87" stroke="#5d4037" stroke-width="2" marker-end="url(#arrow)"/>

  <rect x="245" y="60" width="170" height="55" rx="10" fill="url(#greenGrad)" filter="url(#shadow)"/>
  <text x="330" y="83" text-anchor="middle" font-size="11" fill="#fff" font-weight="600">ğŸ”§ Clean &amp; Prepare</text>
  <text x="330" y="101" text-anchor="middle" font-size="9" fill="#c8e6c9">convert_coordinates()</text>

  <line x1="415" y1="87" x2="455" y2="87" stroke="#5d4037" stroke-width="2" marker-end="url(#arrow)"/>

  <rect x="460" y="60" width="170" height="55" rx="10" fill="url(#greenGrad)" filter="url(#shadow)"/>
  <text x="545" y="83" text-anchor="middle" font-size="11" fill="#fff" font-weight="600">ğŸ“ Build Segments</text>
  <text x="545" y="101" text-anchor="middle" font-size="9" fill="#c8e6c9">process_all_roots()</text>

  <line x1="630" y1="87" x2="670" y2="87" stroke="#5d4037" stroke-width="2" marker-end="url(#arrow)"/>

  <rect x="675" y="60" width="195" height="55" rx="10" fill="url(#greenGrad)" filter="url(#shadow)"/>
  <text x="772" y="83" text-anchor="middle" font-size="11" fill="#fff" font-weight="600">ğŸ“ Segment Metrics</text>
  <text x="772" y="101" text-anchor="middle" font-size="9" fill="#c8e6c9">calc_all_segment_metrics()</text>

  <!-- Arrow down -->
  <line x1="772" y1="115" x2="772" y2="155" stroke="#5d4037" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Row 2: Join + Aggregate -->
  <rect x="610" y="160" width="260" height="55" rx="10" fill="url(#brownGrad)" filter="url(#shadow)"/>
  <text x="740" y="183" text-anchor="middle" font-size="11" fill="#fff" font-weight="600">ğŸŒ³ Join with Tree Locations</text>
  <text x="740" y="201" text-anchor="middle" font-size="9" fill="#d7ccc8">join_nearest_tree() + propagate_tree_name()</text>

  <line x1="610" y1="187" x2="570" y2="187" stroke="#5d4037" stroke-width="2" marker-end="url(#arrow)"/>

  <rect x="330" y="160" width="235" height="55" rx="10" fill="url(#brownGrad)" filter="url(#shadow)"/>
  <text x="447" y="183" text-anchor="middle" font-size="11" fill="#fff" font-weight="600">ğŸ“Š Root &amp; Tree Lengths</text>
  <text x="447" y="201" text-anchor="middle" font-size="9" fill="#d7ccc8">calc_root_length() + calc_tree_length()</text>

  <line x1="330" y1="187" x2="290" y2="187" stroke="#5d4037" stroke-width="2" marker-end="url(#arrow)"/>

  <rect x="30" y="160" width="255" height="55" rx="10" fill="url(#brownGrad)" filter="url(#shadow)"/>
  <text x="157" y="183" text-anchor="middle" font-size="11" fill="#fff" font-weight="600">ğŸ“‰ Depth Stats &amp; Orientation</text>
  <text x="157" y="201" text-anchor="middle" font-size="9" fill="#d7ccc8">calc_depth_stats() + count_orientations()</text>

  <!-- Arrow down from center -->
  <line x1="447" y1="215" x2="447" y2="265" stroke="#5d4037" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Row 3: Spatial analysis -->
  <rect x="30" y="270" width="235" height="55" rx="10" fill="url(#tealGrad)" filter="url(#shadow)"/>
  <text x="147" y="293" text-anchor="middle" font-size="11" fill="#fff" font-weight="600">ğŸ”· 2D Convex Hulls</text>
  <text x="147" y="311" text-anchor="middle" font-size="9" fill="#b2dfdb">build_convex_hulls() + calc_hull_area()</text>

  <rect x="290" y="270" width="315" height="55" rx="10" fill="url(#tealGrad)" filter="url(#shadow)"/>
  <text x="447" y="293" text-anchor="middle" font-size="11" fill="#fff" font-weight="600">ğŸ“¦ 3D Volume Estimate</text>
  <text x="447" y="311" text-anchor="middle" font-size="9" fill="#b2dfdb">calc_real_z() + calc_range_3d()</text>

  <rect x="630" y="270" width="240" height="55" rx="10" fill="url(#tealGrad)" filter="url(#shadow)"/>
  <text x="750" y="293" text-anchor="middle" font-size="11" fill="#fff" font-weight="600">ğŸ“ Root-to-Trunk Distance</text>
  <text x="750" y="311" text-anchor="middle" font-size="9" fill="#b2dfdb">calc_dist_to_trunk()</text>

  <!-- Arrows to overlap -->
  <line x1="147" y1="325" x2="147" y2="365" stroke="#5d4037" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="447" y1="325" x2="447" y2="365" stroke="#5d4037" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Row 4: Output -->
  <rect x="30" y="370" width="570" height="55" rx="10" fill="#e8f5e9" stroke="#2e7d32" stroke-width="2" filter="url(#shadow)"/>
  <text x="315" y="393" text-anchor="middle" font-size="11" fill="#1b5e20" font-weight="600">ğŸ† Overlap / Competition Analysis</text>
  <text x="315" y="411" text-anchor="middle" font-size="9" fill="#2e7d32">calc_all_overlaps() â†’ pairwise overlap area &amp; percentages</text>

  <rect x="630" y="370" width="240" height="55" rx="10" fill="#e8f5e9" stroke="#2e7d32" stroke-width="2" filter="url(#shadow)"/>
  <text x="750" y="393" text-anchor="middle" font-size="11" fill="#1b5e20" font-weight="600">ğŸ’¾ Export</text>
  <text x="750" y="411" text-anchor="middle" font-size="9" fill="#2e7d32">.xlsx / .shp / .gpkg</text>

  <!-- Pipeline wrapper note -->
  <rect x="30" y="455" width="840" height="45" rx="8" fill="#fff8e1" stroke="#f9a825" stroke-width="1.5" stroke-dasharray="6,3"/>
  <text x="450" y="475" text-anchor="middle" font-size="11" fill="#e65100" font-weight="600">âš¡ Shortcuts: prepare_root_data() â†’ build_segments_with_metrics() â†’ summarise_tree_roots()</text>
  <text x="450" y="491" text-anchor="middle" font-size="9" fill="#bf360c">Pipeline wrappers that chain multiple steps into single calls</text>
</svg>
